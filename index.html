<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DENISIAGRAM | COSMIC EMPIRE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root { --p: #00f2ff; --bg: #000; --panel: #0d0d0d; --danger: #ff3b3b; }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; overflow: hidden; height: 100vh; position: relative; }
        
        /* КОСМИЧЕСКАЯ ГРАФИКА */
        .stars-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at center, #001520 0%, #000 100%); overflow: hidden; }
        .star { position: absolute; background: var(--p); borderRadius: 50%; box-shadow: 0 0 10px var(--p); animation: blink 2s infinite alternate; }
        
        /* ВРАЩАЮЩАЯСЯ D */
        .denis-logo { font-size: 80px; font-weight: 900; color: var(--p); text-shadow: 0 0 20px var(--p); display: inline-block; animation: rotateD 4s linear infinite; margin: 20px 0; }
        
        @keyframes rotateD { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }
        @keyframes blink { from { opacity: 0.3; transform: scale(0.8); } to { opacity: 1; transform: scale(1.2); } }

        .line-t, .line-b { position: fixed; left:0; width:100%; height:3px; background: var(--p); z-index: 35000; box-shadow: 0 0 15px var(--p); }
        .line-t { top:0; } .line-b { bottom:0; }
        .page { display:none; height: 100vh; width: 100vw; overflow-y: auto; padding: 60px 15px 120px; position: relative; z-index: 1; }
        .page.active { display: flex; flex-direction: column; align-items: center; }
        nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--panel); border-top: 1px solid #222; display: grid; grid-template-columns: repeat(7, 1fr); padding: 12px 0; z-index: 30000; }
        .nav-link { display: flex; flex-direction: column; align-items: center; color: #555; cursor: pointer;}
        .nav-link.active { color: var(--p); }
        .nav-link span { font-size: 7px; text-transform: uppercase; margin-top: 4px; }
        .btn { width: 100%; padding: 15px; background: var(--p); color: #000; font-weight: bold; border: none; border-radius: 12px; cursor: pointer; margin: 10px 0; box-shadow: 0 0 10px var(--p); }
        .in { width: 100%; padding: 14px; background: #111; border: 1px solid #333; color: #fff; border-radius: 12px; margin: 8px 0; outline: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .card { background: rgba(0,0,0,0.8); border-radius: 15px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid #222;}
        .card-media { width: 100%; aspect-ratio: 1/1; position: relative; overflow: hidden; }
        .card-media img { width: 100%; height: 100%; object-fit: cover; }
        .card-details { padding: 8px 5px; }
        .card-title { font-size: 13px; font-weight: bold; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }
        .card-author { font-size: 10px; color: var(--p); }
        #player { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 60000; display: none; }
        .p-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 6010; display: flex; flex-direction: column; justify-content: space-between; padding: 25px; pointer-events: none; }
        .p-ui * { pointer-events: auto; }
        .side-btn { font-size: 28px; color: #fff; cursor: pointer; transition: 0.2s; }
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:none; align-items: center; justify-content: center; z-index: 50000; }
        .m-cont { width: 90%; max-width: 400px; background: #0d0d0d; border: 1px solid var(--p); padding: 25px; border-radius: 25px; }
        #smart-plus { position: fixed; bottom: 100px; right: 20px; width: 65px; height: 65px; background: var(--p); border-radius: 50%; display: none; align-items: center; justify-content: center; z-index: 15000; color: #000; font-size: 30px; box-shadow: 0 0 15px var(--p); }
    </style>
</head>
<body>

<div class="stars-bg" id="stars-box"></div>
<div class="line-t"></div><div class="line-b"></div>
<div id="smart-plus" onclick="openM('m-upload-type')"><i class="fas fa-plus"></i></div>

<div id="player">
    <div class="p-ui" id="p-controls">
        <div style="display:flex; justify-content:space-between; width: 100%;">
            <i class="fas fa-chevron-left side-btn" onclick="closePlayer()"></i>
            <span id="p-author-name" style="color:var(--p); font-weight:bold;"></span>
        </div>
    </div>
    <div style="width:100%; height:100%;" onclick="togglePlayerUI()">
        <video id="v-play" style="width:100%; height:100%; object-fit:contain; display:none;" loop autoplay controls></video>
        <iframe id="g-play" style="width:100%; height:100%; border:none; display:none; background:#fff;"></iframe>
        <div id="b-play" style="padding:100px 25px; display:none; overflow-y:auto; height:100%; color:#fff; font-size:18px;"></div>
    </div>
</div>

<div id="p-home" class="page active">
    <div class="denis-logo">D</div>
    <h1 style="color:var(--p); letter-spacing: 4px; text-shadow: 0 0 10px var(--p);">DENISIAGRAM</h1>
    <div id="status-info" style="font-size: 10px; margin-bottom: 20px; color: var(--p);">COSMIC PLAYER CORE ONLINE</div>
    <button class="btn" onclick="openM('m-create-ch')">INITIATE CHANNEL</button>
    <div id="ch-list" style="width:100%;"></div>
</div>

<div id="p-view" class="page">
    <div style="display:flex; align-items:center; justify-content:space-between; width:100%; margin-bottom:20px;">
        <i class="fas fa-arrow-left" onclick="showP('p-home')" style="color:var(--p); font-size:24px;"></i>
        <h2 id="view-title" style="color: var(--p);">EXPLORE</h2>
        <div></div>
    </div>
    <div class="grid" id="content-grid"></div>
</div>

<nav>
    <div class="nav-link active" onclick="showP('p-home', this)"><i class="fas fa-home"></i><span>Home</span></div>
    <div class="nav-link" onclick="go('film', this)"><i class="fas fa-film"></i><span>Films</span></div>
    <div class="nav-link" onclick="go('video', this)"><i class="fas fa-video"></i><span>Video</span></div>
    <div class="nav-link" onclick="go('reels', this)"><i class="fas fa-bolt"></i><span>Reels</span></div>
    <div class="nav-link" onclick="go('game', this)"><i class="fas fa-code"></i><span>Code Games</span></div>
    <div class="nav-link" onclick="go('book', this)"><i class="fas fa-book"></i><span>Books</span></div>
    <div class="nav-link" onclick="go('music', this)"><i class="fas fa-music"></i><span>Music</span></div>
</nav>

<div id="m-create-ch" class="modal"><div class="m-cont"><h3>New Channel</h3><input type="text" id="new-ch-name" class="in" placeholder="Name"><input type="file" id="new-ch-img" class="in" accept="image/*"><button class="btn" onclick="createChannel()">CREATE</button></div></div>
<div id="m-upload-type" class="modal"><div class="m-cont"><h3>Upload</h3><div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"><button class="btn" onclick="prepareUpload('film')">FILM</button><button class="btn" onclick="prepareUpload('video')">VIDEO</button><button class="btn" onclick="prepareUpload('reels')">REEL</button><button class="btn" onclick="prepareUpload('game')">CODE GAMES</button><button class="btn" onclick="prepareUpload('book')">BOOK</button><button class="btn" onclick="prepareUpload('music')">MUSIC</button></div></div></div>
<div id="m-final-up" class="modal"><div class="m-cont"><h3 id="up-type-title">Publish</h3><input type="text" id="post-title" class="in" placeholder="Title"><input type="file" id="post-cover" class="in" accept="image/*"><div id="box-file"><input type="file" id="post-file" class="in"></div><div id="box-text" style="display:none"><textarea id="post-data" class="in" rows="5" placeholder="Paste HTML/JS or Text..."></textarea></div><button class="btn" onclick="publishNow()">PUBLISH</button></div></div>

<script>
    let db, curCh, curMode;

    // ГЕНЕРАЦИЯ ЗВЕЗД
    const starBox = document.getElementById('stars-box');
    for(let i=0; i<100; i++) {
        let star = document.createElement('div');
        star.className = 'star';
        let size = Math.random() * 3 + 'px';
        star.style.width = size; star.style.height = size;
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 5 + 's';
        starBox.appendChild(star);
    }

    const req = indexedDB.open("DENISIAGRAM_DB", 1);
    req.onsuccess = e => { db = e.target.result; renderChannels(); };
    req.onupgradeneeded = e => {
        let d = e.target.result;
        d.createObjectStore('channels', {keyPath:'id', autoIncrement:true});
        d.createObjectStore('posts', {keyPath:'id', autoIncrement:true});
    };

    function openM(id){ document.getElementById(id).style.display='flex'; }
    function closeM(){ document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); }

    function createChannel(){
        const n=document.getElementById('new-ch-name').value, f=document.getElementById('new-ch-img').files[0];
        if(!n || !f) return;
        const r=new FileReader(); r.onload=e=>{
            db.transaction('channels','readwrite').objectStore('channels').add({name:n, img:e.target.result}).onsuccess=()=>{
                renderChannels(); closeM();
            };
        }; r.readAsDataURL(f);
    }

    function renderChannels(){
        const l=document.getElementById('ch-list'); l.innerHTML='';
        db.transaction('channels').objectStore('channels').getAll().onsuccess=e=>{
            e.target.result.forEach(ch=>{
                let d=document.createElement('div');
                d.style="padding:15px; background:rgba(17,17,17,0.8); border-radius:15px; margin-top:10px; display:flex; align-items:center; gap:15px; border:1px solid var(--p);";
                d.innerHTML=`<img src="${ch.img}" style="width:45px; height:45px; border-radius:50%; object-fit:cover; border: 1px solid var(--p);"><b>${ch.name}</b>`;
                d.onclick=()=>{curCh=ch; go('channel');}; l.appendChild(d);
            });
        };
    }

    function go(m, el){
        curMode=m; document.getElementById('view-title').innerText=m.toUpperCase();
        showP('p-view', el); renderGrid();
    }

    function showP(id, el){
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(el){ document.querySelectorAll('.nav-link').forEach(n=>n.classList.remove('active')); el.classList.add('active'); }
        document.getElementById('smart-plus').style.display = (curCh && id==='p-view') ? 'flex' : 'none';
    }

    function prepareUpload(type){
        curMode = type; closeM();
        document.getElementById('up-type-title').innerText = "Publish " + (type==='game'?'CODE GAMES':type).toUpperCase();
        document.getElementById('box-file').style.display = (type==='game'||type==='book') ? 'none' : 'block';
        document.getElementById('box-text').style.display = (type==='game'||type==='book') ? 'block' : 'none';
        openM('m-final-up');
    }

    function publishNow(){
        const t=document.getElementById('post-title').value, c=document.getElementById('post-cover').files[0], f=document.getElementById('post-file').files[0], d=document.getElementById('post-data').value;
        if(!t || !c) return;
        const r=new FileReader(); r.onload=e=>{
            const p = {title:t, cover:e.target.result, type:curMode, cid:curCh.id, author:curCh.name, data:d};
            if(f){ const r2=new FileReader(); r2.onload=ev=>{p.file=ev.target.result; saveDB(p);}; r2.readAsDataURL(f); }
            else { saveDB(p); }
        }; r.readAsDataURL(c);
    }

    function saveDB(p){ 
        db.transaction('posts','readwrite').objectStore('posts').add(p).onsuccess=()=>{ closeM(); renderGrid(); }; 
    }

    function renderGrid(){
        const g=document.getElementById('content-grid'); g.innerHTML='';
        db.transaction('posts').objectStore('posts').getAll().onsuccess=e=>{
            e.target.result.filter(p=>curMode==='channel'?p.cid===curCh.id:p.type===curMode).reverse().forEach(p=>{
                let d=document.createElement('div'); d.className='card';
                d.innerHTML=`<div class="card-media"><img src="${p.cover}"></div><div class="card-details"><span class="card-title">${p.title}</span><span class="card-author">${p.author}</span></div>`;
                d.onclick=()=>openPlayer(p); g.appendChild(d);
            });
        };
    }

    function openPlayer(p){
        document.getElementById('player').style.display='block';
        document.getElementById('p-author-name').innerText = p.author;
        const v=document.getElementById('v-play'), g=document.getElementById('g-play'), b=document.getElementById('b-play');
        v.style.display=g.style.display=b.style.display='none';
        if(p.type==='game'){ g.style.display='block'; g.srcdoc = `<html><body style="margin:0;">${p.data}</body></html>`; }
        else if(p.type==='book'){ b.style.display='block'; b.innerText = p.data; }
        else { v.style.display='block'; v.src=p.file; }
    }

    function closePlayer(){ 
        document.getElementById('player').style.display='none'; 
        document.getElementById('v-play').pause(); 
        document.getElementById('g-play').srcdoc = "";
    }
    function togglePlayerUI(){ const ui=document.getElementById('p-controls'); ui.style.display=(ui.style.display==='none')?'flex':'none';}
</script>
</body>
</html>
